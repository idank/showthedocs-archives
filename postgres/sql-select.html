<h1 id="SQL-SELECT">SELECT</h1> <div class="REFNAMEDIV" id="AEN86558">  <h2>Name</h2>SELECT, TABLE, WITH -- retrieve rows from a table or view </div> <div class="REFSYNOPSISDIV" id="AEN86563">  <h2>Synopsis</h2> <pre class="SYNOPSIS" data-language="sql">
[ WITH [ RECURSIVE ] with_query [, ...] ]
SELECT [ ALL | DISTINCT [ ON ( expression [, ...] ) ] ]
    [ * | expression [ [ AS ] output_name ] [, ...] ]
    [ FROM from_item [, ...] ]
    [ WHERE condition ]
    [ GROUP BY grouping_element [, ...] ]
    [ HAVING condition [, ...] ]
    [ WINDOW window_name AS ( window_definition ) [, ...] ]
    [ { UNION | INTERSECT | EXCEPT } [ ALL | DISTINCT ] select ]
    [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]
    [ LIMIT { count | ALL } ]
    [ OFFSET start [ ROW | ROWS ] ]
    [ FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } ONLY ]
    [ FOR { UPDATE | NO KEY UPDATE | SHARE | KEY SHARE } [ OF table_name [, ...] ] [ NOWAIT | SKIP LOCKED ] [...] ]

where from_item can be one of:

    [ ONLY ] table_name [ * ] [ [ AS ] alias [ ( column_alias [, ...] ) ] ]
                [ TABLESAMPLE sampling_method ( argument [, ...] ) [ REPEATABLE ( seed ) ] ]
    [ LATERAL ] ( select ) [ AS ] alias [ ( column_alias [, ...] ) ]
    with_query_name [ [ AS ] alias [ ( column_alias [, ...] ) ] ]
    [ LATERAL ] function_name ( [ argument [, ...] ] )
                [ WITH ORDINALITY ] [ [ AS ] alias [ ( column_alias [, ...] ) ] ]
    [ LATERAL ] function_name ( [ argument [, ...] ] ) [ AS ] alias ( column_definition [, ...] )
    [ LATERAL ] function_name ( [ argument [, ...] ] ) AS ( column_definition [, ...] )
    [ LATERAL ] ROWS FROM( function_name ( [ argument [, ...] ] ) [ AS ( column_definition [, ...] ) ] [, ...] )
                [ WITH ORDINALITY ] [ [ AS ] alias [ ( column_alias [, ...] ) ] ]
    from_item [ NATURAL ] join_type from_item [ ON join_condition | USING ( join_column [, ...] ) ]

and grouping_element can be one of:

    ( )
    expression
    ( expression [, ...] )
    ROLLUP ( { expression | ( expression [, ...] ) } [, ...] )
    CUBE ( { expression | ( expression [, ...] ) } [, ...] )
    GROUPING SETS ( grouping_element [, ...] )

and with_query is:

    with_query_name [ ( column_name [, ...] ) ] AS ( select | values | insert | update | delete )

TABLE [ ONLY ] table_name [ * ]
</pre> </div> <div class="REFSECT1" id="AEN86636">  <h2>Description</h2> <p><code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> retrieves rows from zero or more tables. The general processing of <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> is as follows:</p> <ol type="1"> <li> <p>All queries in the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> list are computed. These effectively serve as temporary tables that can be referenced in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list. A <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query that is referenced more than once in <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> is computed only once. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-WITH">WITH Clause</a> below.)</p> </li> <li> <p>All elements in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list are computed. (Each element in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list is a real or virtual table.) If more than one element is specified in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list, they are cross-joined together. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-FROM">FROM Clause</a> below.)</p> </li> <li> <p>If the <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clause is specified, all rows that do not satisfy the condition are eliminated from the output. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-WHERE">WHERE Clause</a> below.)</p> </li> <li> <p>If the <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause is specified, or if there are aggregate function calls, the output is combined into groups of rows that match on one or more values, and the results of aggregate functions are computed. If the <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> clause is present, it eliminates groups that do not satisfy the given condition. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-GROUPBY">GROUP BY Clause</a> and <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-HAVING">HAVING Clause</a> below.)</p> </li> <li> <p>The actual output rows are computed using the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> output expressions for each selected row or row group. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-SELECT-LIST">SELECT List</a> below.)</p> </li> <li> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="select distinct">SELECT DISTINCT</code> eliminates duplicate rows from the result. <code class="LITERAL">SELECT DISTINCT ON</code> eliminates rows that match on all the specified expressions. <code class="LITERAL showdocs-decorate-back" data-showdocs="select all">SELECT ALL</code> (the default) will return all candidate rows, including duplicates. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-DISTINCT">DISTINCT Clause</a> below.)</p> </li> <li> <p>Using the operators <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code>, and <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code>, the output of more than one <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement can be combined to form a single result set. The <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> operator returns all rows that are in one or both of the result sets. The <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> operator returns all rows that are strictly in both result sets. The <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> operator returns the rows that are in the first result set but not in the second. In all three cases, duplicate rows are eliminated unless <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> is specified. The noise word <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> can be added to explicitly specify eliminating duplicate rows. Notice that <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> is the default behavior here, even though <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> is the default for <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> itself. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-UNION">UNION Clause</a>, <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-INTERSECT">INTERSECT Clause</a>, and <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-EXCEPT">EXCEPT Clause</a> below.)</p> </li> <li> <p>If the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause is specified, the returned rows are sorted in the specified order. If <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> is not given, the rows are returned in whatever order the system finds fastest to produce. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-ORDERBY">ORDER BY Clause</a> below.)</p> </li> <li> <p>If the <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> (or <code class="LITERAL showdocs-decorate-back" data-showdocs="fetch first">FETCH FIRST</code>) or <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code> clause is specified, the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement only returns a subset of the result rows. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-LIMIT">LIMIT Clause</a> below.)</p> </li> <li> <p>If <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> is specified, the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement locks the selected rows against concurrent updates. (See <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-FOR-UPDATE-SHARE">The Locking Clause</a> below.)</p> </li> </ol> <p>You must have <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> privilege on each column used in a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> command. The use of <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> requires <code class="LITERAL showdocs-decorate-back" data-showdocs="update">UPDATE</code> privilege as well (for at least one column of each table so selected).</p> </div> <div class="REFSECT1" id="AEN86720">  <h2>Parameters</h2> <div class="REFSECT2 showdocs-decorate-block" id="SQL-WITH" data-showdocs="with">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> clause allows you to specify one or more subqueries that can be referenced by name in the primary query. The subqueries effectively act as temporary tables or views for the duration of the primary query. Each subquery can be a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="table">TABLE</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="values">VALUES</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="insert">INSERT</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="update">UPDATE</code> or <code class="COMMAND showdocs-decorate-back" data-showdocs="delete">DELETE</code> statement. When writing a data-modifying statement (<code class="COMMAND showdocs-decorate-back" data-showdocs="insert">INSERT</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="update">UPDATE</code> or <code class="COMMAND showdocs-decorate-back" data-showdocs="delete">DELETE</code>) in <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code>, it is usual to include a <code class="LITERAL showdocs-decorate-back" data-showdocs="returning">RETURNING</code> clause. It is the output of <code class="LITERAL showdocs-decorate-back" data-showdocs="returning">RETURNING</code>, <span class="emphasis EMPHASIS c4">not</span> the underlying table that the statement modifies, that forms the temporary table that is read by the primary query. If <code class="LITERAL showdocs-decorate-back" data-showdocs="returning">RETURNING</code> is omitted, the statement is still executed, but it produces no output so it cannot be referenced as a table by the primary query.</p> <p>A name (without schema qualification) must be specified for each <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query. Optionally, a list of column names can be specified; if this is omitted, the column names are inferred from the subquery.</p> <p>If <code class="LITERAL showdocs-decorate-back" data-showdocs="recursive">RECURSIVE</code> is specified, it allows a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> subquery to reference itself by name. Such a subquery must have the form</p> <pre class="SYNOPSIS" data-language="sql">
non_recursive_term UNION [ ALL | DISTINCT ] recursive_term
</pre> <p>where the recursive self-reference must appear on the right-hand side of the <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>. Only one recursive self-reference is permitted per query. Recursive data-modifying statements are not supported, but you can use the results of a recursive <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> query in a data-modifying statement. See <a href="http://www.postgresql.org/docs/9.5/static/queries-with.html">Section 7.8</a> for an example.</p> <p>Another effect of <code class="LITERAL showdocs-decorate-back" data-showdocs="recursive">RECURSIVE</code> is that <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries need not be ordered: a query can reference another one that is later in the list. (However, circular references, or mutual recursion, are not implemented.) Without <code class="LITERAL showdocs-decorate-back" data-showdocs="recursive">RECURSIVE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries can only reference sibling <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries that are earlier in the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> list.</p> <p>A key property of <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries is that they are evaluated only once per execution of the primary query, even if the primary query refers to them more than once. In particular, data-modifying statements are guaranteed to be executed once and only once, regardless of whether the primary query reads all or any of their output.</p> <p>The primary query and the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries are all (notionally) executed at the same time. This implies that the effects of a data-modifying statement in <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> cannot be seen from other parts of the query, other than by reading its <code class="LITERAL showdocs-decorate-back" data-showdocs="returning">RETURNING</code> output. If two such data-modifying statements attempt to modify the same row, the results are unspecified.</p> <p>See <a href="http://www.postgresql.org/docs/9.5/static/queries-with.html">Section 7.8</a> for additional information.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-FROM" data-showdocs="from">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause specifies one or more source tables for the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>. If multiple sources are specified, the result is the Cartesian product (cross join) of all the sources. But usually qualification conditions are added (via <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code>) to restrict the returned rows to a small subset of the Cartesian product.</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause can contain the following elements:</p> <div class="VARIABLELIST"> <dl> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="table_name">table_name</code></dt> <dd> <p>The name (optionally schema-qualified) of an existing table or view. If <code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code> is specified before the table name, only that table is scanned. If <code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code> is not specified, the table and all its descendant tables (if any) are scanned. Optionally, <code class="LITERAL showdocs-decorate-back" data-showdocs="*">*</code> can be specified after the table name to explicitly indicate that descendant tables are included.</p> </dd> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="alias">alias</code></dt> <dd> <p>A substitute name for the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item containing the alias. An alias is used for brevity or to eliminate ambiguity for self-joins (where the same table is scanned multiple times). When an alias is provided, it completely hides the actual name of the table or function; for example given <code class="LITERAL showdocs-decorate-back" data-showdocs="from foo as f">FROM foo AS f</code>, the remainder of the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> must refer to this <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item as <code class="LITERAL showdocs-decorate-back" data-showdocs="f">f</code> not <code class="LITERAL showdocs-decorate-back" data-showdocs="foo">foo</code>. If an alias is written, a column alias list can also be written to provide substitute names for one or more columns of the table.</p> </dd> <dt><code class="LITERAL">TABLESAMPLE <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="sampling_method">sampling_method</code> ( <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="argument">argument</code> [, ...] ) [ REPEATABLE ( <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="seed">seed</code> ) ]</code></dt> <dd> <p>A <code class="LITERAL showdocs-decorate-back" data-showdocs="tablesample">TABLESAMPLE</code> clause after a <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="table_name">table_name</code> indicates that the specified <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="sampling_method">sampling_method</code> should be used to retrieve a subset of the rows in that table. This sampling precedes the application of any other filters such as <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clauses. The standard <span class="PRODUCTNAME">PostgreSQL</span> distribution includes two sampling methods, <code class="LITERAL showdocs-decorate-back" data-showdocs="bernoulli">BERNOULLI</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="system">SYSTEM</code>, and other sampling methods can be installed in the database via extensions.</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="bernoulli">BERNOULLI</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="system">SYSTEM</code> sampling methods each accept a single <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="argument">argument</code> which is the fraction of the table to sample, expressed as a percentage between 0 and 100. This argument can be any <code class="TYPE showdocs-decorate-back" data-showdocs="real">real</code>-valued expression. (Other sampling methods might accept more or different arguments.) These two methods each return a randomly-chosen sample of the table that will contain approximately the specified percentage of the table's rows. The <code class="LITERAL showdocs-decorate-back" data-showdocs="bernoulli">BERNOULLI</code> method scans the whole table and selects or ignores individual rows independently with the specified probability. The <code class="LITERAL showdocs-decorate-back" data-showdocs="system">SYSTEM</code> method does block-level sampling with each block having the specified chance of being selected; all rows in each selected block are returned. The <code class="LITERAL showdocs-decorate-back" data-showdocs="system">SYSTEM</code> method is significantly faster than the <code class="LITERAL showdocs-decorate-back" data-showdocs="bernoulli">BERNOULLI</code> method when small sampling percentages are specified, but it may return a less-random sample of the table as a result of clustering effects.</p> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="repeatable">REPEATABLE</code> clause specifies a <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="seed">seed</code> number or expression to use for generating random numbers within the sampling method. The seed value can be any non-null floating-point value. Two queries that specify the same seed and <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="argument">argument</code> values will select the same sample of the table, if the table has not been changed meanwhile. But different seed values will usually produce different samples. If <code class="LITERAL showdocs-decorate-back" data-showdocs="repeatable">REPEATABLE</code> is not given then a new random sample is selected for each query. Note that some add-on sampling methods do not accept <code class="LITERAL showdocs-decorate-back" data-showdocs="repeatable">REPEATABLE</code>, and will always produce new samples on each use.</p> </dd> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="select">select</code></dt> <dd> <p>A sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> can appear in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause. This acts as though its output were created as a temporary table for the duration of this single <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> command. Note that the sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> must be surrounded by parentheses, and an alias <span class="emphasis EMPHASIS c4">must</span> be provided for it. A <a href="http://www.postgresql.org/docs/9.5/static/sql-values.html">VALUES</a> command can also be used here.</p> </dd> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="with_query_name">with_query_name</code></dt> <dd> <p>A <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query is referenced by writing its name, just as though the query's name were a table name. (In fact, the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query hides any real table of the same name for the purposes of the primary query. If necessary, you can refer to a real table of the same name by schema-qualifying the table's name.) An alias can be provided in the same way as for a table.</p> </dd> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="function_name">function_name</code></dt> <dd> <p>Function calls can appear in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause. (This is especially useful for functions that return result sets, but any function can be used.) This acts as though the function's output were created as a temporary table for the duration of this single <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> command. When the optional <code class="COMMAND showdocs-decorate-back" data-showdocs="with ordinality">WITH ORDINALITY</code> clause is added to the function call, a new column is appended after all the function's output columns with numbering for each row.</p> <p>An alias can be provided in the same way as for a table. If an alias is written, a column alias list can also be written to provide substitute names for one or more attributes of the function's composite return type, including the column added by <code class="LITERAL showdocs-decorate-back" data-showdocs="ordinality">ORDINALITY</code> if present.</p> <p>Multiple function calls can be combined into a single <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>-clause item by surrounding them with <code class="LITERAL">ROWS FROM( ... )</code>. The output of such an item is the concatenation of the first row from each function, then the second row from each function, etc. If some of the functions produce fewer rows than others, NULLs are substituted for the missing data, so that the total number of rows returned is always the same as for the function that produced the most rows.</p> <p>If the function has been defined as returning the <code class="TYPE showdocs-decorate-back" data-showdocs="record">record</code> data type, then an alias or the key word <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> must be present, followed by a column definition list in the form <code class="LITERAL">( <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="column_name">column_name</code> <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="data_type">data_type</code> [<span class="OPTIONAL">, ...</span> ])</code>. The column definition list must match the actual number and types of columns returned by the function.</p> <p>When using the <code class="LITERAL">ROWS FROM( ... )</code> syntax, if one of the functions requires a column definition list, it's preferred to put the column definition list after the function call inside <code class="LITERAL">ROWS FROM( ... )</code>. A column definition list can be placed after the <code class="LITERAL">ROWS FROM( ... )</code> construct only if there's just a single function and no <code class="LITERAL showdocs-decorate-back" data-showdocs="with ordinality">WITH ORDINALITY</code> clause.</p> <p>To use <code class="LITERAL showdocs-decorate-back" data-showdocs="ordinality">ORDINALITY</code> together with a column definition list, you must use the <code class="LITERAL">ROWS FROM( ... )</code> syntax and put the column definition list inside <code class="LITERAL">ROWS FROM( ... )</code>.</p> </dd> <dt><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_type">join_type</code></dt> <dd> <p>One of</p> <ul> <li> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="[ inner ] join">[ INNER ] JOIN</code></p> </li> <li> <p><code class="LITERAL">LEFT [ OUTER ] JOIN</code></p> </li> <li> <p><code class="LITERAL">RIGHT [ OUTER ] JOIN</code></p> </li> <li> <p><code class="LITERAL">FULL [ OUTER ] JOIN</code></p> </li> <li> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="cross join">CROSS JOIN</code></p> </li> </ul> <p>For the <code class="LITERAL showdocs-decorate-back" data-showdocs="inner">INNER</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="outer">OUTER</code> join types, a join condition must be specified, namely exactly one of <code class="LITERAL showdocs-decorate-back" data-showdocs="natural">NATURAL</code>, <code class="LITERAL">ON <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_condition">join_condition</code></code>, or <code class="LITERAL">USING (<code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_column">join_column</code> [, ...])</code>. See below for the meaning. For <code class="LITERAL showdocs-decorate-back" data-showdocs="cross join">CROSS JOIN</code>, none of these clauses can appear.</p> <p>A <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code> clause combines two <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> items, which for convenience we will refer to as <span class="QUOTE">"tables"</span>, though in reality they can be any type of <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item. Use parentheses if necessary to determine the order of nesting. In the absence of parentheses, <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code>s nest left-to-right. In any case <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code> binds more tightly than the commas separating <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>-list items.</p> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="cross join">CROSS JOIN</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="inner join">INNER JOIN</code> produce a simple Cartesian product, the same result as you get from listing the two tables at the top level of <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>, but restricted by the join condition (if any). <code class="LITERAL showdocs-decorate-back" data-showdocs="cross join">CROSS JOIN</code> is equivalent to <code class="LITERAL">INNER JOIN ON (TRUE)</code>, that is, no rows are removed by qualification. These join types are just a notational convenience, since they do nothing you couldn't do with plain <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code>.</p> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="left outer join">LEFT OUTER JOIN</code> returns all rows in the qualified Cartesian product (i.e., all combined rows that pass its join condition), plus one copy of each row in the left-hand table for which there was no right-hand row that passed the join condition. This left-hand row is extended to the full width of the joined table by inserting null values for the right-hand columns. Note that only the <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code> clause's own condition is considered while deciding which rows have matches. Outer conditions are applied afterwards.</p> <p>Conversely, <code class="LITERAL">RIGHT OUTER JOIN</code> returns all the joined rows, plus one row for each unmatched right-hand row (extended with nulls on the left). This is just a notational convenience, since you could convert it to a <code class="LITERAL showdocs-decorate-back" data-showdocs="left outer join">LEFT OUTER JOIN</code> by switching the left and right tables.</p> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="full outer join">FULL OUTER JOIN</code> returns all the joined rows, plus one row for each unmatched left-hand row (extended with nulls on the right), plus one row for each unmatched right-hand row (extended with nulls on the left).</p> </dd> <dt><code class="LITERAL">ON <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_condition">join_condition</code></code></dt> <dd> <p><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_condition">join_condition</code> is an expression resulting in a value of type <code class="TYPE showdocs-decorate-back" data-showdocs="boolean">boolean</code> (similar to a <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clause) that specifies which rows in a join are considered to match.</p> </dd> <dt><code class="LITERAL">USING ( <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="join_column">join_column</code> [, ...] )</code></dt> <dd> <p>A clause of the form <code class="LITERAL">USING ( a, b, ... )</code> is shorthand for <code class="LITERAL">ON left_table.a = right_table.a AND left_table.b = right_table.b ...</code>. Also, <code class="LITERAL showdocs-decorate-back" data-showdocs="using">USING</code> implies that only one of each pair of equivalent columns will be included in the join output, not both.</p> </dd> <dt><code class="LITERAL showdocs-decorate-back" data-showdocs="natural">NATURAL</code></dt> <dd> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="natural">NATURAL</code> is shorthand for a <code class="LITERAL showdocs-decorate-back" data-showdocs="using">USING</code> list that mentions all columns in the two tables that have the same names.</p> </dd> <dt><code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code></dt> <dd> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> key word can precede a sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item. This allows the sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> to refer to columns of <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> items that appear before it in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list. (Without <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code>, each sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> is evaluated independently and so cannot cross-reference any other <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item.)</p> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> can also precede a function-call <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item, but in this case it is a noise word, because the function expression can refer to earlier <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> items in any case.</p> <p>A <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> item can appear at top level in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list, or within a <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code> tree. In the latter case it can also refer to any items that are on the left-hand side of a <code class="LITERAL showdocs-decorate-back" data-showdocs="join">JOIN</code> that it is on the right-hand side of.</p> <p>When a <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item contains <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> cross-references, evaluation proceeds as follows: for each row of the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item providing the cross-referenced column(s), or set of rows of multiple <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> items providing the columns, the <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> item is evaluated using that row or row set's values of the columns. The resulting row(s) are joined as usual with the rows they were computed from. This is repeated for each row or set of rows from the column source table(s).</p> <p>The column source table(s) must be <code class="LITERAL showdocs-decorate-back" data-showdocs="inner">INNER</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="left">LEFT</code> joined to the <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> item, else there would not be a well-defined set of rows from which to compute each set of rows for the <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> item. Thus, although a construct such as <code class="LITERAL"><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="x">X</code> RIGHT JOIN LATERAL <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="y">Y</code></code> is syntactically valid, it is not actually allowed for <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="y">Y</code> to reference <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="x">X</code>.</p> </dd> </dl> </div> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-WHERE" data-showdocs="where">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> Clause</h3> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clause has the general form</p> <pre class="SYNOPSIS" data-language="sql">
WHERE condition
</pre> <p>where <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="condition">condition</code> is any expression that evaluates to a result of type <code class="TYPE showdocs-decorate-back" data-showdocs="boolean">boolean</code>. Any row that does not satisfy this condition will be eliminated from the output. A row satisfies the condition if it returns true when the actual row values are substituted for any variable references.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-GROUPBY" data-showdocs="groupby">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> Clause</h3> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause has the general form</p> <pre class="SYNOPSIS" data-language="sql">
GROUP BY grouping_element [, ...]
</pre> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> will condense into a single row all selected rows that share the same values for the grouped expressions. An <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="expression">expression</code> used inside a <code class="REPLACEABLE c2">grouping_element</code> can be an input column name, or the name or ordinal number of an output column (<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> list item), or an arbitrary expression formed from input-column values. In case of ambiguity, a <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> name will be interpreted as an input-column name rather than an output column name.</p> <p>If any of <code class="LITERAL showdocs-decorate-back" data-showdocs="grouping sets">GROUPING SETS</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="rollup">ROLLUP</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="cube">CUBE</code> are present as grouping elements, then the <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause as a whole defines some number of independent <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="grouping sets">grouping sets</code>. The effect of this is equivalent to constructing a <code class="LITERAL showdocs-decorate-back" data-showdocs="union all">UNION ALL</code> between subqueries with the individual grouping sets as their <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clauses. For further details on the handling of grouping sets see <a href="http://www.postgresql.org/docs/9.5/static/queries-table-expressions.html#QUERIES-GROUPING-SETS">Section 7.2.4</a>.</p> <p>Aggregate functions, if any are used, are computed across all rows making up each group, producing a separate value for each group. (If there are aggregate functions but no <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause, the query is treated as having a single group comprising all the selected rows.) The set of rows fed to each aggregate function can be further filtered by attaching a <code class="LITERAL showdocs-decorate-back" data-showdocs="filter">FILTER</code> clause to the aggregate function call; see <a href="http://www.postgresql.org/docs/9.5/static/sql-expressions.html#SYNTAX-AGGREGATES">Section 4.2.7</a> for more information. When a <code class="LITERAL showdocs-decorate-back" data-showdocs="filter">FILTER</code> clause is present, only those rows matching it are included in the input to that aggregate function.</p> <p>When <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> is present, or any aggregate functions are present, it is not valid for the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> list expressions to refer to ungrouped columns except within aggregate functions or when the ungrouped column is functionally dependent on the grouped columns, since there would otherwise be more than one possible value to return for an ungrouped column. A functional dependency exists if the grouped columns (or a subset thereof) are the primary key of the table containing the ungrouped column.</p> <p>Keep in mind that all aggregate functions are evaluated before evaluating any <span class="QUOTE">"scalar"</span> expressions in the <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> clause or <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> list. This means that, for example, a <code class="LITERAL showdocs-decorate-back" data-showdocs="case">CASE</code> expression cannot be used to skip evaluation of an aggregate function; see <a href="http://www.postgresql.org/docs/9.5/static/sql-expressions.html#SYNTAX-EXPRESS-EVAL">Section 4.2.14</a>.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified with <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-HAVING" data-showdocs="having">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> Clause</h3> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> clause has the general form</p> <pre class="SYNOPSIS" data-language="sql">
HAVING condition
</pre> <p>where <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="condition">condition</code> is the same as specified for the <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clause.</p> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> eliminates group rows that do not satisfy the condition. <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> is different from <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code>: <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> filters individual rows before the application of <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code>, while <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> filters group rows created by <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code>. Each column referenced in <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="condition">condition</code> must unambiguously reference a grouping column, unless the reference appears within an aggregate function or the ungrouped column is functionally dependent on the grouping columns.</p> <p>The presence of <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> turns a query into a grouped query even if there is no <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause. This is the same as what happens when the query contains aggregate functions but no <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause. All the selected rows are considered to form a single group, and the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> list and <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> clause can only reference table columns from within aggregate functions. Such a query will emit a single row if the <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> condition is true, zero rows if it is not true.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified with <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-WINDOW" data-showdocs="window">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> Clause</h3> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause has the general form</p> <pre class="SYNOPSIS" data-language="sql">
WINDOW window_name AS ( window_definition ) [, ...]
</pre> <p>where <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="window_name">window_name</code> is a name that can be referenced from <code class="LITERAL showdocs-decorate-back" data-showdocs="over">OVER</code> clauses or subsequent window definitions, and <code class="REPLACEABLE c2">window_definition</code> is</p> <pre class="SYNOPSIS" data-language="sql">
[ existing_window_name ]
[ PARTITION BY expression [, ...] ]
[ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]
[ frame_clause ]
</pre> <p>If an <code class="REPLACEABLE c2">existing_window_name</code> is specified it must refer to an earlier entry in the <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> list; the new window copies its partitioning clause from that entry, as well as its ordering clause if any. In this case the new window cannot specify its own <code class="LITERAL showdocs-decorate-back" data-showdocs="partition by">PARTITION BY</code> clause, and it can specify <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> only if the copied window does not have one. The new window always uses its own frame clause; the copied window must not specify a frame clause.</p> <p>The elements of the <code class="LITERAL showdocs-decorate-back" data-showdocs="partition by">PARTITION BY</code> list are interpreted in much the same fashion as elements of a <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-GROUPBY">GROUP BY Clause</a>, except that they are always simple expressions and never the name or number of an output column. Another difference is that these expressions can contain aggregate function calls, which are not allowed in a regular <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause. They are allowed here because windowing occurs after grouping and aggregation.</p> <p>Similarly, the elements of the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> list are interpreted in much the same fashion as elements of an <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-ORDERBY">ORDER BY Clause</a>, except that the expressions are always taken as simple expressions and never the name or number of an output column.</p> <p>The optional <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_clause">frame_clause</code> defines the <i class="FIRSTTERM">window frame</i> for window functions that depend on the frame (not all do). The window frame is a set of related rows for each row of the query (called the <i class="FIRSTTERM">current row</i>). The <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_clause">frame_clause</code> can be one of</p> <pre class="SYNOPSIS" data-language="sql">
{ RANGE | ROWS } frame_start
{ RANGE | ROWS } BETWEEN frame_start AND frame_end
</pre> <p>where <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_start">frame_start</code> and <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_end">frame_end</code> can be one of</p> <pre class="SYNOPSIS" data-language="sql">
UNBOUNDED PRECEDING
value PRECEDING
CURRENT ROW
value FOLLOWING
UNBOUNDED FOLLOWING
</pre> <p>If <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_end">frame_end</code> is omitted it defaults to <code class="LITERAL showdocs-decorate-back" data-showdocs="current row">CURRENT ROW</code>. Restrictions are that <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_start">frame_start</code> cannot be <code class="LITERAL">UNBOUNDED FOLLOWING</code>, <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_end">frame_end</code> cannot be <code class="LITERAL">UNBOUNDED PRECEDING</code>, and the <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_end">frame_end</code> choice cannot appear earlier in the above list than the <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_start">frame_start</code> choice — for example <code class="LITERAL">RANGE BETWEEN CURRENT ROW AND <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="value">value</code> PRECEDING</code> is not allowed.</p> <p>The default framing option is <code class="LITERAL">RANGE UNBOUNDED PRECEDING</code>, which is the same as <code class="LITERAL">RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>; it sets the frame to be all rows from the partition start up through the current row's last peer (a row that <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> considers equivalent to the current row, or all rows if there is no <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>). In general, <code class="LITERAL">UNBOUNDED PRECEDING</code> means that the frame starts with the first row of the partition, and similarly <code class="LITERAL">UNBOUNDED FOLLOWING</code> means that the frame ends with the last row of the partition (regardless of <code class="LITERAL showdocs-decorate-back" data-showdocs="range">RANGE</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="rows">ROWS</code> mode). In <code class="LITERAL showdocs-decorate-back" data-showdocs="rows">ROWS</code> mode, <code class="LITERAL showdocs-decorate-back" data-showdocs="current row">CURRENT ROW</code> means that the frame starts or ends with the current row; but in <code class="LITERAL showdocs-decorate-back" data-showdocs="range">RANGE</code> mode it means that the frame starts or ends with the current row's first or last peer in the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> ordering. The <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="value">value</code> <code class="LITERAL showdocs-decorate-back" data-showdocs="preceding">PRECEDING</code> and <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="value">value</code> <code class="LITERAL showdocs-decorate-back" data-showdocs="following">FOLLOWING</code> cases are currently only allowed in <code class="LITERAL showdocs-decorate-back" data-showdocs="rows">ROWS</code> mode. They indicate that the frame starts or ends with the row that many rows before or after the current row. <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="value">value</code> must be an integer expression not containing any variables, aggregate functions, or window functions. The value must not be null or negative; but it can be zero, which selects the current row itself.</p> <p>Beware that the <code class="LITERAL showdocs-decorate-back" data-showdocs="rows">ROWS</code> options can produce unpredictable results if the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> ordering does not order the rows uniquely. The <code class="LITERAL showdocs-decorate-back" data-showdocs="range">RANGE</code> options are designed to ensure that rows that are peers in the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> ordering are treated alike; all peer rows will be in the same frame.</p> <p>The purpose of a <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause is to specify the behavior of <i class="FIRSTTERM">window functions</i> appearing in the query's <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-SELECT-LIST">SELECT List</a> or <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-ORDERBY">ORDER BY Clause</a>. These functions can reference the <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause entries by name in their <code class="LITERAL showdocs-decorate-back" data-showdocs="over">OVER</code> clauses. A <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause entry does not have to be referenced anywhere, however; if it is not used in the query it is simply ignored. It is possible to use window functions without any <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause at all, since a window function call can specify its window definition directly in its <code class="LITERAL showdocs-decorate-back" data-showdocs="over">OVER</code> clause. However, the <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> clause saves typing when the same window definition is needed for more than one window function.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified with <code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code>.</p> <p>Window functions are described in detail in <a href="http://www.postgresql.org/docs/9.5/static/tutorial-window.html">Section 3.5</a>, <a href="http://www.postgresql.org/docs/9.5/static/sql-expressions.html#SYNTAX-WINDOW-FUNCTIONS">Section 4.2.8</a>, and <a href="http://www.postgresql.org/docs/9.5/static/queries-table-expressions.html#QUERIES-WINDOW">Section 7.2.5</a>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-SELECT-LIST" data-showdocs="select-list">  <h3>
<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> List</h3> <p>The <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> list (between the key words <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>) specifies expressions that form the output rows of the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement. The expressions can (and usually do) refer to columns computed in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause.</p> <p>Just as in a table, every output column of a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> has a name. In a simple <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> this name is just used to label the column for display, but when the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> is a sub-query of a larger query, the name is seen by the larger query as the column name of the virtual table produced by the sub-query. To specify the name to use for an output column, write <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="output_name">output_name</code> after the column's expression. (You can omit <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code>, but only if the desired output name does not match any <span class="PRODUCTNAME">PostgreSQL</span> keyword (see <a href="http://www.postgresql.org/docs/9.5/static/sql-keywords-appendix.html">Appendix C</a>). For protection against possible future keyword additions, it is recommended that you always either write <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> or double-quote the output name.) If you do not specify a column name, a name is chosen automatically by <span class="PRODUCTNAME">PostgreSQL</span>. If the column's expression is a simple column reference then the chosen name is the same as that column's name. In more complex cases a function or type name may be used, or the system may fall back on a generated name such as <code class="LITERAL showdocs-decorate-back" data-showdocs="?column?">?column?</code>.</p> <p>An output column's name can be used to refer to the column's value in <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clauses, but not in the <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="having">HAVING</code> clauses; there you must write out the expression instead.</p> <p>Instead of an expression, <code class="LITERAL showdocs-decorate-back" data-showdocs="*">*</code> can be written in the output list as a shorthand for all the columns of the selected rows. Also, you can write <code class="LITERAL showdocs-decorate-back" data-showdocs="table_name.*"><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="table_name">table_name</code>.*</code> as a shorthand for the columns coming from just that table. In these cases it is not possible to specify new names with <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code>; the output column names will be the same as the table columns' names.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-DISTINCT" data-showdocs="distinct">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> Clause</h3> <p>If <code class="LITERAL showdocs-decorate-back" data-showdocs="select distinct">SELECT DISTINCT</code> is specified, all duplicate rows are removed from the result set (one row is kept from each group of duplicates). <code class="LITERAL showdocs-decorate-back" data-showdocs="select all">SELECT ALL</code> specifies the opposite: all rows are kept; that is the default.</p> <p><code class="LITERAL">SELECT DISTINCT ON ( <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="expression">expression</code> [, ...] )</code> keeps only the first row of each set of rows where the given expressions evaluate to equal. The <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct on">DISTINCT ON</code> expressions are interpreted using the same rules as for <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> (see above). Note that the <span class="QUOTE">"first row"</span> of each set is unpredictable unless <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> is used to ensure that the desired row appears first. For example:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT DISTINCT ON (location) location, time, report
    FROM weather_reports
    ORDER BY location, time DESC;
</pre> <p>retrieves the most recent weather report for each location. But if we had not used <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> to force descending order of time values for each location, we'd have gotten a report from an unpredictable time for each location.</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct on">DISTINCT ON</code> expression(s) must match the leftmost <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> expression(s). The <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause will normally contain additional expression(s) that determine the desired precedence of rows within each <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct on">DISTINCT ON</code> group.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified with <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-UNION" data-showdocs="union">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> clause has this general form:</p> <pre class="SYNOPSIS" data-language="sql">
select_statement UNION [ ALL | DISTINCT ] select_statement
</pre> <p><code class="REPLACEABLE c2">select_statement</code> is any <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement without an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code>, or <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> clause. (<code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> can be attached to a subexpression if it is enclosed in parentheses. Without parentheses, these clauses will be taken to apply to the result of the <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>, not to its right-hand input expression.)</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> operator computes the set union of the rows returned by the involved <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statements. A row is in the set union of two result sets if it appears in at least one of the result sets. The two <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statements that represent the direct operands of the <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> must produce the same number of columns, and corresponding columns must be of compatible data types.</p> <p>The result of <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> does not contain any duplicate rows unless the <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> option is specified. <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> prevents elimination of duplicates. (Therefore, <code class="LITERAL showdocs-decorate-back" data-showdocs="union all">UNION ALL</code> is usually significantly quicker than <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>; use <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> when you can.) <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> can be written to explicitly specify the default behavior of eliminating duplicate rows.</p> <p>Multiple <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> operators in the same <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement are evaluated left to right, unless otherwise indicated by parentheses.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified either for a <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code> result or for any input of a <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-INTERSECT" data-showdocs="intersect">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> clause has this general form:</p> <pre class="SYNOPSIS" data-language="sql">
select_statement INTERSECT [ ALL | DISTINCT ] select_statement
</pre> <p><code class="REPLACEABLE c2">select_statement</code> is any <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement without an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code>, or <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> clause.</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> operator computes the set intersection of the rows returned by the involved <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statements. A row is in the intersection of two result sets if it appears in both result sets.</p> <p>The result of <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> does not contain any duplicate rows unless the <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> option is specified. With <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code>, a row that has <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="m">m</code> duplicates in the left table and <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="n">n</code> duplicates in the right table will appear min(<code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="m">m</code>,<code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="n">n</code>) times in the result set. <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> can be written to explicitly specify the default behavior of eliminating duplicate rows.</p> <p>Multiple <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> operators in the same <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement are evaluated left to right, unless parentheses dictate otherwise. <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> binds more tightly than <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>. That is, <code class="LITERAL">A UNION B INTERSECT C</code> will be read as <code class="LITERAL">A UNION (B INTERSECT C)</code>.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified either for an <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code> result or for any input of an <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-EXCEPT" data-showdocs="except">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> clause has this general form:</p> <pre class="SYNOPSIS" data-language="sql">
select_statement EXCEPT [ ALL | DISTINCT ] select_statement
</pre> <p><code class="REPLACEABLE c2">select_statement</code> is any <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement without an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code>, or <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> clause.</p> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> operator computes the set of rows that are in the result of the left <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement but not in the result of the right one.</p> <p>The result of <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> does not contain any duplicate rows unless the <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> option is specified. With <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code>, a row that has <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="m">m</code> duplicates in the left table and <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="n">n</code> duplicates in the right table will appear max(<code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="m">m</code>-<code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="n">n</code>,0) times in the result set. <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> can be written to explicitly specify the default behavior of eliminating duplicate rows.</p> <p>Multiple <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> operators in the same <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement are evaluated left to right, unless parentheses dictate otherwise. <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> binds at the same level as <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>.</p> <p>Currently, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> cannot be specified either for an <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> result or for any input of an <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-ORDERBY" data-showdocs="orderby">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> Clause</h3> <p>The optional <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause has this general form:</p> <pre class="SYNOPSIS" data-language="sql">
ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...]
</pre> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause causes the result rows to be sorted according to the specified expression(s). If two rows are equal according to the leftmost expression, they are compared according to the next expression and so on. If they are equal according to all specified expressions, they are returned in an implementation-dependent order.</p> <p>Each <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="expression">expression</code> can be the name or ordinal number of an output column (<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> list item), or it can be an arbitrary expression formed from input-column values.</p> <p>The ordinal number refers to the ordinal (left-to-right) position of the output column. This feature makes it possible to define an ordering on the basis of a column that does not have a unique name. This is never absolutely necessary because it is always possible to assign a name to an output column using the <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> clause.</p> <p>It is also possible to use arbitrary expressions in the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause, including columns that do not appear in the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> output list. Thus the following statement is valid:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT name FROM distributors ORDER BY code;
</pre> <p>A limitation of this feature is that an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause applying to the result of a <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code>, or <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code> clause can only specify an output column name or number, not an expression.</p> <p>If an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> expression is a simple name that matches both an output column name and an input column name, <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> will interpret it as the output column name. This is the opposite of the choice that <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> will make in the same situation. This inconsistency is made to be compatible with the SQL standard.</p> <p>Optionally one can add the key word <code class="LITERAL showdocs-decorate-back" data-showdocs="asc">ASC</code> (ascending) or <code class="LITERAL showdocs-decorate-back" data-showdocs="desc">DESC</code> (descending) after any expression in the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause. If not specified, <code class="LITERAL showdocs-decorate-back" data-showdocs="asc">ASC</code> is assumed by default. Alternatively, a specific ordering operator name can be specified in the <code class="LITERAL showdocs-decorate-back" data-showdocs="using">USING</code> clause. An ordering operator must be a less-than or greater-than member of some B-tree operator family. <code class="LITERAL showdocs-decorate-back" data-showdocs="asc">ASC</code> is usually equivalent to <code class="LITERAL showdocs-decorate-back" data-showdocs="using &lt;">USING &lt;</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="desc">DESC</code> is usually equivalent to <code class="LITERAL showdocs-decorate-back" data-showdocs="using &gt;">USING &gt;</code>. (But the creator of a user-defined data type can define exactly what the default sort ordering is, and it might correspond to operators with other names.)</p> <p>If <code class="LITERAL showdocs-decorate-back" data-showdocs="nulls last">NULLS LAST</code> is specified, null values sort after all non-null values; if <code class="LITERAL showdocs-decorate-back" data-showdocs="nulls first">NULLS FIRST</code> is specified, null values sort before all non-null values. If neither is specified, the default behavior is <code class="LITERAL showdocs-decorate-back" data-showdocs="nulls last">NULLS LAST</code> when <code class="LITERAL showdocs-decorate-back" data-showdocs="asc">ASC</code> is specified or implied, and <code class="LITERAL showdocs-decorate-back" data-showdocs="nulls first">NULLS FIRST</code> when <code class="LITERAL showdocs-decorate-back" data-showdocs="desc">DESC</code> is specified (thus, the default is to act as though nulls are larger than non-nulls). When <code class="LITERAL showdocs-decorate-back" data-showdocs="using">USING</code> is specified, the default nulls ordering depends on whether the operator is a less-than or greater-than operator.</p> <p>Note that ordering options apply only to the expression they follow; for example <code class="LITERAL">ORDER BY x, y DESC</code> does not mean the same thing as <code class="LITERAL">ORDER BY x DESC, y DESC</code>.</p> <p>Character-string data is sorted according to the collation that applies to the column being sorted. That can be overridden at need by including a <code class="LITERAL showdocs-decorate-back" data-showdocs="collate">COLLATE</code> clause in the <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="expression">expression</code>, for example <code class="LITERAL">ORDER BY mycolumn COLLATE "en_US"</code>. For more information see <a href="http://www.postgresql.org/docs/9.5/static/sql-expressions.html#SQL-SYNTAX-COLLATE-EXPRS">Section 4.2.10</a> and <a href="http://www.postgresql.org/docs/9.5/static/collation.html">Section 22.2</a>.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-LIMIT" data-showdocs="limit">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> Clause</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> clause consists of two independent sub-clauses:</p> <pre class="SYNOPSIS" data-language="sql">
LIMIT { count | ALL }
OFFSET start
</pre> <p><code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="count">count</code> specifies the maximum number of rows to return, while <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="start">start</code> specifies the number of rows to skip before starting to return rows. When both are specified, <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="start">start</code> rows are skipped before starting to count the <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="count">count</code> rows to be returned.</p> <p>If the <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="count">count</code> expression evaluates to NULL, it is treated as <code class="LITERAL showdocs-decorate-back" data-showdocs="limit all">LIMIT ALL</code>, i.e., no limit. If <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="start">start</code> evaluates to NULL, it is treated the same as <code class="LITERAL showdocs-decorate-back" data-showdocs="offset 0">OFFSET 0</code>.</p> <p>SQL:2008 introduced a different syntax to achieve the same result, which <span class="PRODUCTNAME">PostgreSQL</span> also supports. It is:</p> <pre class="SYNOPSIS" data-language="sql">
OFFSET start { ROW | ROWS }
FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } ONLY
</pre> <p>In this syntax, to write anything except a simple integer constant for <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="start">start</code> or <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="count">count</code>, you must write parentheses around it. If <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="count">count</code> is omitted in a <code class="LITERAL showdocs-decorate-back" data-showdocs="fetch">FETCH</code> clause, it defaults to 1. <code class="LITERAL showdocs-decorate-back" data-showdocs="row">ROW</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="rows">ROWS</code> as well as <code class="LITERAL showdocs-decorate-back" data-showdocs="first">FIRST</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="next">NEXT</code> are noise words that don't influence the effects of these clauses. According to the standard, the <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code> clause must come before the <code class="LITERAL showdocs-decorate-back" data-showdocs="fetch">FETCH</code> clause if both are present; but <span class="PRODUCTNAME">PostgreSQL</span> is laxer and allows either order.</p> <p>When using <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>, it is a good idea to use an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause that constrains the result rows into a unique order. Otherwise you will get an unpredictable subset of the query's rows — you might be asking for the tenth through twentieth rows, but tenth through twentieth in what ordering? You don't know what ordering unless you specify <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>.</p> <p>The query planner takes <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> into account when generating a query plan, so you are very likely to get different plans (yielding different row orders) depending on what you use for <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code>. Thus, using different <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>/<code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code> values to select different subsets of a query result <span class="emphasis EMPHASIS c4">will give inconsistent results</span> unless you enforce a predictable result ordering with <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>. This is not a bug; it is an inherent consequence of the fact that SQL does not promise to deliver the results of a query in any particular order unless <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> is used to constrain the order.</p> <p>It is even possible for repeated executions of the same <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> query to return different subsets of the rows of a table, if there is not an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> to enforce selection of a deterministic subset. Again, this is not a bug; determinism of the results is simply not guaranteed in such a case.</p> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-FOR-UPDATE-SHARE" data-showdocs="for-update-share">  <h3>The Locking Clause</h3> <p><code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> are <i class="FIRSTTERM">locking clauses</i>; they affect how <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> locks rows as they are obtained from the table.</p> <p>The locking clause has the general form</p> <pre class="SYNOPSIS" data-language="sql">
FOR lock_strength [ OF table_name [, ...] ] [ NOWAIT | SKIP LOCKED ]
</pre> <p>where <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="lock_strength">lock_strength</code> can be one of</p> <pre class="SYNOPSIS" data-language="sql">
UPDATE
NO KEY UPDATE
SHARE
KEY SHARE
</pre> <p>For more information on each row-level lock mode, refer to <a href="http://www.postgresql.org/docs/9.5/static/explicit-locking.html#LOCKING-ROWS">Section 13.3.2</a>.</p> <p>To prevent the operation from waiting for other transactions to commit, use either the <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="skip locked">SKIP LOCKED</code> option. With <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code>, the statement reports an error, rather than waiting, if a selected row cannot be locked immediately. With <code class="LITERAL showdocs-decorate-back" data-showdocs="skip locked">SKIP LOCKED</code>, any selected rows that cannot be immediately locked are skipped. Skipping locked rows provides an inconsistent view of the data, so this is not suitable for general purpose work, but can be used to avoid lock contention with multiple consumers accessing a queue-like table. Note that <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="skip locked">SKIP LOCKED</code> apply only to the row-level lock(s) — the required <code class="LITERAL showdocs-decorate-back" data-showdocs="row share">ROW SHARE</code> table-level lock is still taken in the ordinary way (see <a href="http://www.postgresql.org/docs/9.5/static/mvcc.html">Chapter 13</a>). You can use <a href="http://www.postgresql.org/docs/9.5/static/sql-lock.html">LOCK</a> with the <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code> option first, if you need to acquire the table-level lock without waiting.</p> <p>If specific tables are named in a locking clause, then only rows coming from those tables are locked; any other tables used in the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> are simply read as usual. A locking clause without a table list affects all tables used in the statement. If a locking clause is applied to a view or sub-query, it affects all tables used in the view or sub-query. However, these clauses do not apply to <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries referenced by the primary query. If you want row locking to occur within a <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query, specify a locking clause within the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query.</p> <p>Multiple locking clauses can be written if it is necessary to specify different locking behavior for different tables. If the same table is mentioned (or implicitly affected) by more than one locking clause, then it is processed as if it was only specified by the strongest one. Similarly, a table is processed as <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code> if that is specified in any of the clauses affecting it. Otherwise, it is processed as <code class="LITERAL showdocs-decorate-back" data-showdocs="skip locked">SKIP LOCKED</code> if that is specified in any of the clauses affecting it.</p> <p>The locking clauses cannot be used in contexts where returned rows cannot be clearly identified with individual table rows; for example they cannot be used with aggregation.</p> <p>When a locking clause appears at the top level of a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> query, the rows that are locked are exactly those that are returned by the query; in the case of a join query, the rows locked are those that contribute to returned join rows. In addition, rows that satisfied the query conditions as of the query snapshot will be locked, although they will not be returned if they were updated after the snapshot and no longer satisfy the query conditions. If a <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> is used, locking stops once enough rows have been returned to satisfy the limit (but note that rows skipped over by <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code> will get locked). Similarly, if a locking clause is used in a cursor's query, only rows actually fetched or stepped past by the cursor will be locked.</p> <p>When a locking clause appears in a sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>, the rows locked are those returned to the outer query by the sub-query. This might involve fewer rows than inspection of the sub-query alone would suggest, since conditions from the outer query might be used to optimize execution of the sub-query. For example,</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT * FROM (SELECT * FROM mytable FOR UPDATE) ss WHERE col1 = 5;
</pre> <p>will lock only rows having <code class="LITERAL showdocs-decorate-back" data-showdocs="col1 = 5">col1 = 5</code>, even though that condition is not textually within the sub-query.</p> <p>Previous releases failed to preserve a lock which is upgraded by a later savepoint. For example, this code:</p> <pre class="PROGRAMLISTING" data-language="sql">
BEGIN;
SELECT * FROM mytable WHERE key = 1 FOR UPDATE;
SAVEPOINT s;
UPDATE mytable SET ... WHERE key = 1;
ROLLBACK TO s;
</pre> <p>would fail to preserve the <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code> lock after the <code class="COMMAND showdocs-decorate-back" data-showdocs="rollback to">ROLLBACK TO</code>. This has been fixed in release 9.3.</p> <div class="CAUTION"> <table class="CAUTION"> <tr> <td class="c5">Caution</td> </tr> <tr> <td> <p>It is possible for a <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> command running at the <code class="LITERAL showdocs-decorate-back" data-showdocs="read committed">READ COMMITTED</code> transaction isolation level and using <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> and a locking clause to return rows out of order. This is because <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> is applied first. The command sorts the result, but might then block trying to obtain a lock on one or more of the rows. Once the <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> unblocks, some of the ordering column values might have been modified, leading to those rows appearing to be out of order (though they are in order in terms of the original column values). This can be worked around at need by placing the <code class="LITERAL">FOR UPDATE/SHARE</code> clause in a sub-query, for example</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT * FROM (SELECT * FROM mytable FOR UPDATE) ss ORDER BY column1;
</pre> <p>Note that this will result in locking all rows of <code class="STRUCTNAME showdocs-decorate-back" data-showdocs="mytable">mytable</code>, whereas <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code> at the top level would lock only the actually returned rows. This can make for a significant performance difference, particularly if the <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> is combined with <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> or other restrictions. So this technique is recommended only if concurrent updates of the ordering columns are expected and a strictly sorted result is required.</p> <p>At the <code class="LITERAL showdocs-decorate-back" data-showdocs="repeatable read">REPEATABLE READ</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="serializable">SERIALIZABLE</code> transaction isolation level this would cause a serialization failure (with a <code class="LITERAL showdocs-decorate-back" data-showdocs="sqlstate">SQLSTATE</code> of <code class="LITERAL showdocs-decorate-back" data-showdocs="'40001'">'40001'</code>), so there is no possibility of receiving rows out of order under these isolation levels.</p> </td> </tr> </table> </div> </div> <div class="REFSECT2 showdocs-decorate-block" id="SQL-TABLE" data-showdocs="table">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="table">TABLE</code> Command</h3> <p>The command</p> <pre class="PROGRAMLISTING" data-language="sql">
TABLE name
</pre> <p>is equivalent to</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT * FROM name
</pre> <p>It can be used as a top-level command or as a space-saving syntax variant in parts of complex queries. Only the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="intersect">INTERSECT</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="except">EXCEPT</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="fetch">FETCH</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for">FOR</code> locking clauses can be used with <code class="COMMAND showdocs-decorate-back" data-showdocs="table">TABLE</code>; the <code class="LITERAL showdocs-decorate-back" data-showdocs="where">WHERE</code> clause and any form of aggregation cannot be used.</p> </div> </div> <div class="REFSECT1" id="AEN87539">  <h2>Examples</h2> <p>To join the table <code class="LITERAL showdocs-decorate-back" data-showdocs="films">films</code> with the table <code class="LITERAL showdocs-decorate-back" data-showdocs="distributors">distributors</code>:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT f.title, f.did, d.name, f.date_prod, f.kind
    FROM distributors d, films f
    WHERE f.did = d.did

       title       | did |     name     | date_prod  |   kind
-------------------+-----+--------------+------------+----------
 The Third Man     | 101 | British Lion | 1949-12-23 | Drama
 The African Queen | 101 | British Lion | 1951-08-11 | Romantic
 ...
</pre> <p>To sum the column <code class="LITERAL showdocs-decorate-back" data-showdocs="len">len</code> of all films and group the results by <code class="LITERAL showdocs-decorate-back" data-showdocs="kind">kind</code>:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT kind, sum(len) AS total FROM films GROUP BY kind;

   kind   | total
----------+-------
 Action   | 07:34
 Comedy   | 02:58
 Drama    | 14:28
 Musical  | 06:42
 Romantic | 04:38
</pre> <p>To sum the column <code class="LITERAL showdocs-decorate-back" data-showdocs="len">len</code> of all films, group the results by <code class="LITERAL showdocs-decorate-back" data-showdocs="kind">kind</code> and show those group totals that are less than 5 hours:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT kind, sum(len) AS total
    FROM films
    GROUP BY kind
    HAVING sum(len) &lt; interval '5 hours';

   kind   | total
----------+-------
 Comedy   | 02:58
 Romantic | 04:38
</pre> <p>The following two examples are identical ways of sorting the individual results according to the contents of the second column (<code class="LITERAL showdocs-decorate-back" data-showdocs="name">name</code>):</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT * FROM distributors ORDER BY name;
SELECT * FROM distributors ORDER BY 2;

 did |       name
-----+------------------
 109 | 20th Century Fox
 110 | Bavaria Atelier
 101 | British Lion
 107 | Columbia
 102 | Jean Luc Godard
 113 | Luso films
 104 | Mosfilm
 103 | Paramount
 106 | Toho
 105 | United Artists
 111 | Walt Disney
 112 | Warner Bros.
 108 | Westward
</pre> <p>The next example shows how to obtain the union of the tables <code class="LITERAL showdocs-decorate-back" data-showdocs="distributors">distributors</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="actors">actors</code>, restricting the results to those that begin with the letter W in each table. Only distinct rows are wanted, so the key word <code class="LITERAL showdocs-decorate-back" data-showdocs="all">ALL</code> is omitted.</p> <pre class="PROGRAMLISTING" data-language="sql">
distributors:               actors:
 did |     name              id |     name
-----+--------------        ----+----------------
 108 | Westward               1 | Woody Allen
 111 | Walt Disney            2 | Warren Beatty
 112 | Warner Bros.           3 | Walter Matthau
 ...                         ...

SELECT distributors.name
    FROM distributors
    WHERE distributors.name LIKE 'W%'
UNION
SELECT actors.name
    FROM actors
    WHERE actors.name LIKE 'W%';

      name
----------------
 Walt Disney
 Walter Matthau
 Warner Bros.
 Warren Beatty
 Westward
 Woody Allen
</pre> <p>This example shows how to use a function in the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause, both with and without a column definition list:</p> <pre class="PROGRAMLISTING" data-language="sql">
CREATE FUNCTION distributors(int) RETURNS SETOF distributors AS $$
    SELECT * FROM distributors WHERE did = $1;
$$ LANGUAGE SQL;

SELECT * FROM distributors(111);
 did |    name
-----+-------------
 111 | Walt Disney

CREATE FUNCTION distributors_2(int) RETURNS SETOF record AS $$
    SELECT * FROM distributors WHERE did = $1;
$$ LANGUAGE SQL;

SELECT * FROM distributors_2(111) AS (f1 int, f2 text);
 f1  |     f2
-----+-------------
 111 | Walt Disney
</pre> <p>Here is an example of a function with an ordinality column added:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT * FROM unnest(ARRAY['a','b','c','d','e','f']) WITH ORDINALITY;
 unnest | ordinality
--------+----------
 a      |        1
 b      |        2
 c      |        3
 d      |        4
 e      |        5
 f      |        6
(6 rows)
</pre> <p>This example shows how to use a simple <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> clause:</p> <pre class="PROGRAMLISTING" data-language="sql">
WITH t AS (
    SELECT random() as x FROM generate_series(1, 3)
  )
SELECT * FROM t
UNION ALL
SELECT * FROM t

         x          
--------------------
  0.534150459803641
  0.520092216785997
 0.0735620250925422
  0.534150459803641
  0.520092216785997
 0.0735620250925422
</pre> <p>Notice that the <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> query was evaluated only once, so that we got two sets of the same three random values.</p> <p>This example uses <code class="LITERAL showdocs-decorate-back" data-showdocs="with recursive">WITH RECURSIVE</code> to find all subordinates (direct or indirect) of the employee Mary, and their level of indirectness, from a table that shows only direct subordinates:</p> <pre class="PROGRAMLISTING" data-language="sql">
WITH RECURSIVE employee_recursive(distance, employee_name, manager_name) AS (
    SELECT 1, employee_name, manager_name
    FROM employee
    WHERE manager_name = 'Mary'
  UNION ALL
    SELECT er.distance + 1, e.employee_name, e.manager_name
    FROM employee_recursive er, employee e
    WHERE er.employee_name = e.manager_name
  )
SELECT distance, employee_name FROM employee_recursive;
</pre> <p>Notice the typical form of recursive queries: an initial condition, followed by <code class="LITERAL showdocs-decorate-back" data-showdocs="union">UNION</code>, followed by the recursive part of the query. Be sure that the recursive part of the query will eventually return no tuples, or else the query will loop indefinitely. (See <a href="http://www.postgresql.org/docs/9.5/static/queries-with.html">Section 7.8</a> for more examples.)</p> <p>This example uses <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> to apply a set-returning function <code class="FUNCTION">get_product_names()</code> for each row of the <code class="STRUCTNAME showdocs-decorate-back" data-showdocs="manufacturers">manufacturers</code> table:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT m.name AS mname, pname
FROM manufacturers m, LATERAL get_product_names(m.id) pname;
</pre> <p>Manufacturers not currently having any products would not appear in the result, since it is an inner join. If we wished to include the names of such manufacturers in the result, we could do:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT m.name AS mname, pname
FROM manufacturers m LEFT JOIN LATERAL get_product_names(m.id) pname ON true;
</pre> </div> <div class="REFSECT1" id="AEN87581">  <h2>Compatibility</h2> <p>Of course, the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> statement is compatible with the SQL standard. But there are some extensions and some missing features.</p> <div class="REFSECT2" id="AEN87585">  <h3>Omitted <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> Clauses</h3> <p><span class="PRODUCTNAME">PostgreSQL</span> allows one to omit the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause. It has a straightforward use to compute the results of simple expressions:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT 2+2;

 ?column?
----------
        4
</pre> <p>Some other <acronym class="ACRONYM">SQL</acronym> databases cannot do this except by introducing a dummy one-row table from which to do the <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>.</p> <p>Note that if a <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause is not specified, the query cannot reference any database tables. For example, the following query is invalid:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT distributors.* WHERE distributors.name = 'Westward';
</pre> <p><span class="PRODUCTNAME">PostgreSQL</span> releases prior to 8.1 would accept queries of this form, and add an implicit entry to the query's <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> clause for each table referenced by the query. This is no longer allowed.</p> </div> <div class="REFSECT2" id="AEN87599">  <h3>Empty <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> Lists</h3> <p>The list of output expressions after <code class="LITERAL showdocs-decorate-back" data-showdocs="select">SELECT</code> can be empty, producing a zero-column result table. This is not valid syntax according to the SQL standard. <span class="PRODUCTNAME">PostgreSQL</span> allows it to be consistent with allowing zero-column tables. However, an empty list is not allowed when <code class="LITERAL showdocs-decorate-back" data-showdocs="distinct">DISTINCT</code> is used.</p> </div> <div class="REFSECT2" id="AEN87606">  <h3>Omitting the <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> Key Word</h3> <p>In the SQL standard, the optional key word <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> can be omitted before an output column name whenever the new column name is a valid column name (that is, not the same as any reserved keyword). <span class="PRODUCTNAME">PostgreSQL</span> is slightly more restrictive: <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> is required if the new column name matches any keyword at all, reserved or not. Recommended practice is to use <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> or double-quote output column names, to prevent any possible conflict against future keyword additions.</p> <p>In <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> items, both the standard and <span class="PRODUCTNAME">PostgreSQL</span> allow <code class="LITERAL showdocs-decorate-back" data-showdocs="as">AS</code> to be omitted before an alias that is an unreserved keyword. But this is impractical for output column names, because of syntactic ambiguities.</p> </div> <div class="REFSECT2" id="AEN87618">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code> and Inheritance</h3> <p>The SQL standard requires parentheses around the table name when writing <code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code>, for example <code class="LITERAL">SELECT * FROM ONLY (tab1), ONLY (tab2) WHERE ...</code>. <span class="PRODUCTNAME">PostgreSQL</span> considers these parentheses to be optional.</p> <p><span class="PRODUCTNAME">PostgreSQL</span> allows a trailing <code class="LITERAL showdocs-decorate-back" data-showdocs="*">*</code> to be written to explicitly specify the non-<code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code> behavior of including child tables. The standard does not allow this.</p> <p>(These points apply equally to all SQL commands supporting the <code class="LITERAL showdocs-decorate-back" data-showdocs="only">ONLY</code> option.)</p> </div> <div class="REFSECT2" id="AEN87631">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="tablesample">TABLESAMPLE</code> Clause Restrictions</h3> <p>The <code class="LITERAL showdocs-decorate-back" data-showdocs="tablesample">TABLESAMPLE</code> clause is currently accepted only on regular tables and materialized views. According to the SQL standard it should be possible to apply it to any <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> item.</p> </div> <div class="REFSECT2" id="AEN87637">  <h3>Function Calls in <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>
</h3> <p><span class="PRODUCTNAME">PostgreSQL</span> allows a function call to be written directly as a member of the <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code> list. In the SQL standard it would be necessary to wrap such a function call in a sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>; that is, the syntax <code class="LITERAL">FROM <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="func">func</code>(...) <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="alias">alias</code></code> is approximately equivalent to <code class="LITERAL">FROM LATERAL (SELECT <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="func">func</code>(...)) <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="alias">alias</code></code>. Note that <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> is considered to be implicit; this is because the standard requires <code class="LITERAL showdocs-decorate-back" data-showdocs="lateral">LATERAL</code> semantics for an <code class="LITERAL showdocs-decorate-back" data-showdocs="unnest()">UNNEST()</code> item in <code class="LITERAL showdocs-decorate-back" data-showdocs="from">FROM</code>. <span class="PRODUCTNAME">PostgreSQL</span> treats <code class="LITERAL showdocs-decorate-back" data-showdocs="unnest()">UNNEST()</code> the same as other set-returning functions.</p> </div> <div class="REFSECT2" id="AEN87656">  <h3>Namespace Available to <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code>
</h3> <p>In the SQL-92 standard, an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> clause can only use output column names or numbers, while a <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> clause can only use expressions based on input column names. <span class="PRODUCTNAME">PostgreSQL</span> extends each of these clauses to allow the other choice as well (but it uses the standard's interpretation if there is ambiguity). <span class="PRODUCTNAME">PostgreSQL</span> also allows both clauses to specify arbitrary expressions. Note that names appearing in an expression will always be taken as input-column names, not as output-column names.</p> <p>SQL:1999 and later use a slightly different definition which is not entirely upward compatible with SQL-92. In most cases, however, <span class="PRODUCTNAME">PostgreSQL</span> will interpret an <code class="LITERAL showdocs-decorate-back" data-showdocs="order by">ORDER BY</code> or <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> expression the same way SQL:1999 does.</p> </div> <div class="REFSECT2" id="AEN87669">  <h3>Functional Dependencies</h3> <p><span class="PRODUCTNAME">PostgreSQL</span> recognizes functional dependency (allowing columns to be omitted from <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code>) only when a table's primary key is included in the <code class="LITERAL showdocs-decorate-back" data-showdocs="group by">GROUP BY</code> list. The SQL standard specifies additional conditions that should be recognized.</p> </div> <div class="REFSECT2" id="AEN87675">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="window">WINDOW</code> Clause Restrictions</h3> <p>The SQL standard provides additional options for the window <code class="REPLACEABLE c2 showdocs-decorate-back" data-showdocs="frame_clause">frame_clause</code>. <span class="PRODUCTNAME">PostgreSQL</span> currently supports only the options listed above.</p> </div> <div class="REFSECT2" id="AEN87681">  <h3>
<code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code>
</h3> <p>The clauses <code class="LITERAL showdocs-decorate-back" data-showdocs="limit">LIMIT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="offset">OFFSET</code> are <span class="PRODUCTNAME">PostgreSQL</span>-specific syntax, also used by <span class="PRODUCTNAME">MySQL</span>. The SQL:2008 standard has introduced the clauses <code class="LITERAL">OFFSET ... FETCH {FIRST|NEXT} ...</code> for the same functionality, as shown above in <a class="c3" href="http://www.postgresql.org/docs/9.5/static/sql-select.html#SQL-LIMIT">LIMIT Clause</a>. This syntax is also used by <span class="PRODUCTNAME">IBM DB2</span>. (Applications written for <span class="PRODUCTNAME">Oracle</span> frequently use a workaround involving the automatically generated <code class="LITERAL showdocs-decorate-back" data-showdocs="rownum">rownum</code> column, which is not available in PostgreSQL, to implement the effects of these clauses.)</p> </div> <div class="REFSECT2" id="AEN87695">  <h3>
<code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code>
</h3> <p>Although <code class="LITERAL showdocs-decorate-back" data-showdocs="for update">FOR UPDATE</code> appears in the SQL standard, the standard allows it only as an option of <code class="COMMAND showdocs-decorate-back" data-showdocs="declare cursor">DECLARE CURSOR</code>. <span class="PRODUCTNAME">PostgreSQL</span> allows it in any <code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code> query as well as in sub-<code class="COMMAND showdocs-decorate-back" data-showdocs="select">SELECT</code>s, but this is an extension. The <code class="LITERAL">FOR NO KEY UPDATE</code>, <code class="LITERAL showdocs-decorate-back" data-showdocs="for share">FOR SHARE</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="for key share">FOR KEY SHARE</code> variants, as well as the <code class="LITERAL showdocs-decorate-back" data-showdocs="nowait">NOWAIT</code> and <code class="LITERAL showdocs-decorate-back" data-showdocs="skip locked">SKIP LOCKED</code> options, do not appear in the standard.</p> </div> <div class="REFSECT2" id="AEN87712">  <h3>Data-Modifying Statements in <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code>
</h3> <p><span class="PRODUCTNAME">PostgreSQL</span> allows <code class="COMMAND showdocs-decorate-back" data-showdocs="insert">INSERT</code>, <code class="COMMAND showdocs-decorate-back" data-showdocs="update">UPDATE</code>, and <code class="COMMAND showdocs-decorate-back" data-showdocs="delete">DELETE</code> to be used as <code class="LITERAL showdocs-decorate-back" data-showdocs="with">WITH</code> queries. This is not found in the SQL standard.</p> </div> <div class="REFSECT2" id="AEN87721">  <h3>Nonstandard Clauses</h3> <p><code class="LITERAL">DISTINCT ON ( ... )</code> is an extension of the SQL standard.</p> <p><code class="LITERAL">ROWS FROM( ... )</code> is an extension of the SQL standard.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    © 1996–2016 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="http://www.postgresql.org/docs/9.5/static/sql-select.html" class="_attribution-link">http://www.postgresql.org/docs/9.5/static/sql-select.html</a>
  </p>
</div>
